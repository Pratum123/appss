<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üìö Quiz App</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #eef1f7; margin: 0; padding: 0; }
    header { background: #3949ab; color: white; padding: 20px; font-size: 24px; text-align: center; }
    .section { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 700px; margin: 30px auto; }
    textarea, input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; font-size: 16px; box-sizing: border-box; }
    .btn { background: #3949ab; color: white; font-weight: bold; border: none; padding: 12px; border-radius: 6px; font-size: 16px; cursor: pointer; margin-top: 10px; }
    .btn-option { display: block; width: 100%; text-align: left; padding: 10px 15px; border-radius: 6px; background: #f0f0f0; border: 1px solid #ccc; margin: 8px 0; font-size: 16px; cursor: pointer; }
    .explanation { margin-top: 20px; font-weight: normal; border-top: 1px solid #ccc; padding-top: 10px; }
    .bold-label { font-weight: bold; display: block; margin-bottom: 5px; color: #222; }
    .edit-btn { float: right; background: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
    .question-item { border-bottom: 1px solid #ddd; padding: 10px 0; }
    .submit-btn { background: #4CAF50; margin-top: 15px; }
    .chart-container { width: 100%; max-width: 300px; margin: 20px auto; }
    .result-stats { display: flex; justify-content: space-around; flex-wrap: wrap; align-items: center; }
    .result-text { margin-bottom: 20px; }
    @media (max-width: 600px) {
      .result-stats { flex-direction: column; }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<header>üìö Quiz App</header>
<h2 id="pageTitle" style="text-align:center; color:#3949ab;"></h2>

<div id="inputSection" class="section" style="display:none;">
  <h3>‚ûï ‡§®‡§Ø‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
  <textarea id="question" placeholder="‡§™‡•ç‡§∞‡§∂‡•ç‡§® (‡§≤‡§æ‡§á‡§® ‡§¨‡•ç‡§∞‡•á‡§ï ‡§ï‡•á ‡§≤‡§ø‡§è Enter ‡§¶‡§¨‡§æ‡§è‡§Å)"></textarea>
  <input id="optA" placeholder="‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ A">
  <input id="optB" placeholder="‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ B">
  <input id="optC" placeholder="‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ C">
  <input id="optD" placeholder="‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ D">
  <select id="correct">
    <option value="A">A</option>
    <option value="B">B</option>
    <option value="C">C</option>
    <option value="D">D</option>
  </select>
  <textarea id="explanation" placeholder="‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ (‡§≤‡§æ‡§á‡§® ‡§¨‡•ç‡§∞‡•á‡§ï ‡§ï‡•á ‡§≤‡§ø‡§è Enter ‡§¶‡§¨‡§æ‡§è‡§Å)"></textarea>
  <button class="btn" onclick="saveQuestion()">üìÇ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>
  <div id="questionCount" style="margin-top:10px;"></div>
  <div id="questionList"></div>
</div>

<div id="practiceSection" class="section" style="display:none;">
  <h3>üéØ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏</h3>
  <div id="progress"></div>
  <div id="gotoContainer" style="margin-top: 15px;">
    <input id="gotoInput" type="number" placeholder="‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" style="width: 60%; padding: 8px;">
    <button id="gotoBtn" onclick="goToQuestion()" class="btn">üîé ‡§ú‡§æ‡§è‡§Ç</button>
  </div>
  <div id="quizQuestion" style="margin-top:15px;"></div>
  <div id="quizOptions"></div>
</div>

<div id="resultSection" class="section" style="display:none;">
  <h3>üìä ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ</h3>
  <div class="result-stats">
    <div class="result-text">
      <p id="resultText"></p>
    </div>
    <div class="chart-container">
      <canvas id="resultChart"></canvas>
    </div>
  </div>
  <button class="btn" onclick="window.location.href='index.html'">üè† ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•á‡§ú ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç</button>
</div>

<script>
let questions = [], currentQuestion = 0, correctCount = 0, incorrectCount = 0, editIndex = -1;

function saveQuestion() {
  const q = document.getElementById("question").value.trim();
  const A = document.getElementById("optA").value.trim();
  const B = document.getElementById("optB").value.trim();
  const C = document.getElementById("optC").value.trim();
  const D = document.getElementById("optD").value.trim();
  const correct = document.getElementById("correct").value;
  const exp = document.getElementById("explanation").value.trim();
  if (!q || !A || !B || !C || !D || !correct) {
    alert("‚ùó ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç!");
    return;
  }
  const newQ = { question: q, options: { A, B, C, D }, correct, explanation: exp };
  if (editIndex >= 0) {
    questions[editIndex] = newQ;
    editIndex = -1;
  } else {
    questions.push(newQ);
  }
  const currentKey = `quiz_${localStorage.getItem("selectedMain")}_${localStorage.getItem("selectedSub")}`;
  localStorage.setItem(currentKey, JSON.stringify(questions));
  document.getElementById("question").value = '';
  document.getElementById("optA").value = '';
  document.getElementById("optB").value = '';
  document.getElementById("optC").value = '';
  document.getElementById("optD").value = '';
  document.getElementById("explanation").value = '';
  document.getElementById("correct").value = 'A';
  document.getElementById("questionCount").textContent = `üî¢ ‡§ï‡•Å‡§≤ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®: ${questions.length}`;
  alert("‚úÖ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§∏‡•á‡§µ ‡§π‡•Å‡§Ü!");
  showAllQuestions();
}

function showAllQuestions() {
  const listDiv = document.getElementById("questionList");
  listDiv.innerHTML = '';
  questions.forEach((q, index) => {
    const div = document.createElement("div");
    div.className = "question-item";
    div.innerHTML = `<strong>Q${index + 1}:</strong> ${q.question.replace(/\n/g, '<br>')} <button class="edit-btn" onclick="editQuestion(${index})">‚úèÔ∏è</button>`;
    listDiv.appendChild(div);
  });
}

function editQuestion(index) {
  const q = questions[index];
  document.getElementById("question").value = q.question;
  document.getElementById("optA").value = q.options.A;
  document.getElementById("optB").value = q.options.B;
  document.getElementById("optC").value = q.options.C;
  document.getElementById("optD").value = q.options.D;
  document.getElementById("correct").value = q.correct;
  document.getElementById("explanation").value = q.explanation;
  editIndex = index;
}

function goToQuestion() {
  const input = parseInt(document.getElementById("gotoInput").value);
  if (!input || input < 1 || input > questions.length) {
    alert("‚ö†Ô∏è ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç (1 ‡§∏‡•á " + questions.length + " ‡§ï‡•á ‡§¨‡•Ä‡§ö)");
    return;
  }
  currentQuestion = input - 1;
  showQuestion();
}

function showQuestion() {
  const q = questions[currentQuestion];
  const formattedQ = q.question.replace(/\n/g, "<br>");
  document.getElementById("quizQuestion").innerHTML = `<strong>üìò ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ${currentQuestion + 1}/${questions.length}:</strong><br>${formattedQ}`;
  const optionsDiv = document.getElementById("quizOptions");
  optionsDiv.innerHTML = '';
  for (let key in q.options) {
    const btn = document.createElement("button");
    btn.className = "btn-option";
    btn.textContent = `${key}: ${q.options[key]}`;
    btn.onclick = () => handleAnswer(key);
    optionsDiv.appendChild(btn);
  }
  
  // Submit Quiz Button
  const submitBtn = document.createElement("button");
  submitBtn.textContent = "‚úÖ ‡§ï‡•ç‡§µ‡§ø‡§ú ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç";
  submitBtn.className = "btn submit-btn";
  submitBtn.onclick = () => {
    if(confirm("‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§ï‡•ç‡§µ‡§ø‡§ú ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?\n‡§Ü‡§™‡§®‡•á ‡§Ö‡§≠‡•Ä ‡§§‡§ï " + (correctCount + incorrectCount) + " ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§ï‡•á ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡§ø‡§è ‡§π‡•à‡§Ç‡•§")) {
      submitQuiz();
    }
  };
  optionsDiv.appendChild(submitBtn);
  
  document.getElementById("progress").textContent = `üìò ${currentQuestion + 1} / ${questions.length}`;
}

function handleAnswer(selected) {
  const q = questions[currentQuestion];
  const optionsDiv = document.getElementById("quizOptions");
  document.querySelectorAll(".btn-option").forEach(btn => btn.disabled = true);

  for (let btn of optionsDiv.children) {
    const key = btn.textContent[0];
    if (key === q.correct) {
      btn.style.backgroundColor = "#4CAF50";
      btn.style.color = "white";
    } else if (key === selected) {
      btn.style.backgroundColor = "#F44336";
      btn.style.color = "white";
    }
  }

  const expl = document.createElement("div");
  expl.className = "explanation";
  expl.innerHTML = `<strong>üìò ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ:</strong><br>${(q.explanation || '‡§ï‡•ã‡§à ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•Ä ‡§ó‡§à ‡§π‡•à').replace(/\n/g, "<br>")}`;
  optionsDiv.appendChild(expl);

  if (selected === q.correct) correctCount++;
  else incorrectCount++;

  const nextBtn = document.createElement("button");
  nextBtn.textContent = currentQuestion < questions.length - 1 ? "‚û°Ô∏è ‡§Ö‡§ó‡§≤‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®" : "‚úÖ ‡§ï‡•ç‡§µ‡§ø‡§ú ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç";
  nextBtn.className = "btn";
  nextBtn.style.marginTop = "20px";
  nextBtn.onclick = () => {
    currentQuestion++;
    if (currentQuestion >= questions.length) submitQuiz();
    else showQuestion();
  };
  optionsDiv.appendChild(nextBtn);
}

function submitQuiz() {
  const totalAnswered = correctCount + incorrectCount;
  const percent = totalAnswered > 0 ? Math.round((correctCount / totalAnswered) * 100) : 0;
  
  document.getElementById("practiceSection").style.display = "none";
  document.getElementById("resultSection").style.display = "block";
  
  document.getElementById("resultText").innerHTML = `
    ‚úÖ ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞: ${correctCount}<br>
    ‚ùå ‡§ó‡§≤‡§§ ‡§â‡§§‡•ç‡§§‡§∞: ${incorrectCount}<br>
    üìù ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§ø‡§è ‡§ó‡§è ‡§™‡•ç‡§∞‡§∂‡•ç‡§®: ${totalAnswered}<br>
    üìä ‡§∏‡§ü‡•Ä‡§ï‡§§‡§æ: ${percent}%`;
  
  // ‡§™‡§æ‡§à ‡§ö‡§æ‡§∞‡•ç‡§ü ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡§æ ‡§ï‡•ã‡§°
  const ctx = document.getElementById('resultChart').getContext('2d');
  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞', '‡§ó‡§≤‡§§ ‡§â‡§§‡•ç‡§§‡§∞'],
      datasets: [{
        data: [correctCount, incorrectCount],
        backgroundColor: ['#4CAF50', '#F44336'],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom',
        },
        title: {
          display: true,
          text: '‡§Ü‡§™‡§ï‡•á ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ',
          font: {
            size: 16
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const label = context.label || '';
              const value = context.raw || 0;
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = Math.round((value / total) * 100);
              return `${label}: ${value} (${percentage}%)`;
            }
          }
        }
      }
    }
  });
}

function populateQuiz() {
  const main = localStorage.getItem("selectedMain");
  const sub = localStorage.getItem("selectedSub");
  const mode = localStorage.getItem("quizMode") || "practice";
  const currentKey = `quiz_${main}_${sub}`;
  questions = JSON.parse(localStorage.getItem(currentKey) || '[]');
  currentQuestion = 0;
  correctCount = 0;
  incorrectCount = 0;
  editIndex = -1;

  document.getElementById("pageTitle").textContent = mode === "input" ? "‚ûï ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ú‡•ã‡§°‡§º‡•á‡§Ç" : "üéØ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏";
  if (mode === "input") {
    document.getElementById("inputSection").style.display = "block";
    document.getElementById("questionCount").textContent = `üî¢ ‡§ï‡•Å‡§≤ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®: ${questions.length}`;
    showAllQuestions();
  } else {
    if (questions.length === 0) {
      alert("‚ùó ‡§ï‡•ã‡§à ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ!");
      window.location.href = "index.html";
    } else {
      document.getElementById("practiceSection").style.display = "block";
      showQuestion();
    }
  }
}

window.onload = populateQuiz;
</script>
</body>
</html>
