<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>ЁЯУЪ Quiz App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #eef1f7; margin: 0; padding: 0; }
    header { background: #3949ab; color: white; padding: 20px; font-size: 24px; text-align: center; }
    .section { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 700px; margin: 30px auto; }
    textarea, input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; font-size: 16px; box-sizing: border-box; }
    .btn { background: #3949ab; color: white; font-weight: bold; border: none; padding: 12px; border-radius: 6px; font-size: 16px; cursor: pointer; margin-top: 10px; }
    .btn-option { display: block; width: 100%; text-align: left; padding: 10px 15px; border-radius: 6px; background: #f0f0f0; border: 1px solid #ccc; margin: 8px 0; font-size: 16px; cursor: pointer; }
    .edit-btn { width: 24px; height: 24px; font-size: 14px; background: red; color: white; border-radius: 50%; border: none; margin-right: 10px; cursor: pointer; line-height: 24px; text-align: center; vertical-align: middle; }
    .explanation { margin-top: 20px; font-weight: bold; border-top: 1px solid #ccc; padding-top: 10px; }
    #gotoContainer { margin-bottom: 15px; }
    #gotoInput { width: 60%; padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
    #gotoBtn { padding: 9px 12px; background: #3949ab; color: white; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>
<header>ЁЯУЪ Quiz App</header>
<h2 id="pageTitle" style="text-align:center; color:#3949ab;"></h2>

<!-- ЁЯУе рдкреНрд░рд╢реНрди рдЬреЛрдбрд╝рдиреЗ рдХрд╛ рд╕реЗрдХреНрд╢рди -->
<div id="inputSection" class="section" style="display:none;">
  <h3>тЮХ рдирдпрд╛ рдкреНрд░рд╢реНрди рдЬреЛрдбрд╝реЗрдВ</h3>
  <textarea id="question" placeholder="рдкреНрд░рд╢реНрди"></textarea>
  <input id="optA" placeholder="рд╡рд┐рдХрд▓реНрдк A">
  <input id="optB" placeholder="рд╡рд┐рдХрд▓реНрдк B">
  <input id="optC" placeholder="рд╡рд┐рдХрд▓реНрдк C">
  <input id="optD" placeholder="рд╡рд┐рдХрд▓реНрдк D">
  <select id="correct">
    <option value="A">A</option>
    <option value="B">B</option>
    <option value="C">C</option>
    <option value="D">D</option>
  </select>
  <textarea id="explanation" placeholder="рд╡реНрдпрд╛рдЦреНрдпрд╛"></textarea>
  <button class="btn" onclick="saveQuestion()">ЁЯУВ рд╕реЗрд╡ рдХрд░реЗрдВ</button>
  <div id="questionCount" style="margin-top:10px;"></div>
  <div id="editList" style="margin-top:10px;"></div>
</div>

<!-- ЁЯОп рдЕрднреНрдпрд╛рд╕ рд╕реЗрдХреНрд╢рди -->
<div id="practiceSection" class="section" style="display:none;">
  <h3>ЁЯОп рдЕрднреНрдпрд╛рд╕</h3>
  <div id="progress"></div>
  <div id="gotoContainer">
    <input id="gotoInput" type="number" placeholder="рдкреНрд░рд╢реНрди рд╕рдВрдЦреНрдпрд╛ рджрд░реНрдЬ рдХрд░реЗрдВ">
    <button id="gotoBtn" onclick="goToQuestion()">ЁЯФО рдЬрд╛рдПрдВ</button>
  </div>
  <div id="quizQuestion"></div>
  <div id="quizOptions"></div>
  <button id="submitBtn" class="btn" onclick="submitQuiz()" style="display:none;">тЬЕ рдХреНрд╡рд┐рдЬ рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ</button>
</div>

<script>
let questions = [], currentQuestion = 0, correctCount = 0, incorrectCount = 0, editIndex = -1;

async function updateGist() {
  const token = localStorage.getItem("gist_token");
  const gistId = localStorage.getItem("gist_id");
  if (!token || !gistId) return;

  const data = {
    subjects: JSON.parse(localStorage.getItem("quiz_subjects") || "{}"),
    main: localStorage.getItem("selectedMain"),
    sub: localStorage.getItem("selectedSub"),
    quizData: {}
  };
  for (let key in localStorage) {
    if (key.startsWith("quiz_")) {
      try {
        data.quizData[key] = JSON.parse(localStorage.getItem(key));
      } catch (e) {}
    }
  }

  await fetch(`https://api.github.com/gists/${gistId}`, {
    method: "PATCH",
    headers: {
      "Authorization": `Bearer ${token}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ files: { "quiz_backup.json": { content: JSON.stringify(data, null, 2) } } })
  });
}

async function autoImportFromGist() {
  const gistId = localStorage.getItem("gist_id");
  if (!gistId) return;
  const res = await fetch(`https://api.github.com/gists/${gistId}`);
  const gist = await res.json();
  const content = gist.files["quiz_backup.json"].content;
  const data = JSON.parse(content);

  if (data.subjects) localStorage.setItem("quiz_subjects", JSON.stringify(data.subjects));
  if (data.main) localStorage.setItem("selectedMain", data.main);
  if (data.sub) localStorage.setItem("selectedSub", data.sub);
  if (data.quizData) {
    for (let key in data.quizData) {
      localStorage.setItem(key, JSON.stringify(data.quizData[key]));
    }
  }
}

window.onload = async () => {
  await autoImportFromGist();
  populateQuiz();
};

function populateQuiz() {
  const main = localStorage.getItem("selectedMain");
  const sub = localStorage.getItem("selectedSub");
  const mode = localStorage.getItem("quizMode") || "practice";
  if (!main || !sub) {
    alert("тЭЧ рд╡рд┐рд╖рдп рдЪрдпрди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛!");
    window.location.href = "index.html";
    return;
  }
  const currentKey = `quiz_${main}_${sub}`;
  questions = JSON.parse(localStorage.getItem(currentKey) || '[]');
  currentQuestion = 0;
  correctCount = 0;
  incorrectCount = 0;
  editIndex = -1;

  document.getElementById("pageTitle").textContent = mode === "input" ? "тЮХ рдкреНрд░рд╢реНрди рдЬреЛрдбрд╝реЗрдВ" : "ЁЯОп рдЕрднреНрдпрд╛рд╕";

  if (mode === "input") {
    document.getElementById("inputSection").style.display = "block";
    document.getElementById("questionCount").textContent = `ЁЯФв рдХреБрд▓ рдкреНрд░рд╢реНрди: ${questions.length}`;
  } else {
    if (questions.length === 0) {
      alert("тЭЧ рдХреЛрдИ рдкреНрд░рд╢реНрди рдирд╣реАрдВ рдорд┐рд▓рд╛!");
      window.location.href = "index.html";
    } else {
      document.getElementById("practiceSection").style.display = "block";
      document.getElementById("submitBtn").style.display = "block";
      showQuestion();
    }
  }
}

function saveQuestion() {
  const q = document.getElementById("question").value.trim();
  const A = document.getElementById("optA").value.trim();
  const B = document.getElementById("optB").value.trim();
  const C = document.getElementById("optC").value.trim();
  const D = document.getElementById("optD").value.trim();
  const correct = document.getElementById("correct").value;
  const exp = document.getElementById("explanation").value.trim();
  if (!q || !A || !B || !C || !D || !correct) {
    alert("тЭЧ рд╕рднреА рдлрд╝реАрд▓реНрдб рднрд░реЗрдВ!");
    return;
  }
  const newQ = { question: q, options: { A, B, C, D }, correct, explanation: exp };
  if (editIndex >= 0) {
    questions[editIndex] = newQ;
    editIndex = -1;
  } else {
    questions.push(newQ);
  }
  const currentKey = `quiz_${localStorage.getItem("selectedMain")}_${localStorage.getItem("selectedSub")}`;
  localStorage.setItem(currentKey, JSON.stringify(questions));
  document.getElementById("question").value = '';
  document.getElementById("optA").value = '';
  document.getElementById("optB").value = '';
  document.getElementById("optC").value = '';
  document.getElementById("optD").value = '';
  document.getElementById("explanation").value = '';
  document.getElementById("correct").value = 'A';
  document.getElementById("questionCount").textContent = `ЁЯФв рдХреБрд▓ рдкреНрд░рд╢реНрди: ${questions.length}`;
  updateGist();
  alert("тЬЕ рдкреНрд░рд╢реНрди рд╕реЗрд╡ рд╣реБрдЖ!");
}

// тЬЕ рдЕрдм рдЕрднреНрдпрд╛рд╕ рдлрдВрдХреНрд╢рди рдЬреЛрдбрд╝реЗрдВ:

function showQuestion(index = currentQuestion) {
  const q = questions[index];
  document.getElementById("progress").innerText = `ЁЯУН рдкреНрд░рд╢реНрди ${index + 1} / ${questions.length}`;
  document.getElementById("quizQuestion").innerHTML = `<strong>${q.question}</strong>`;
  const optionsDiv = document.getElementById("quizOptions");
  optionsDiv.innerHTML = "";
  for (let key in q.options) {
    const btn = document.createElement("button");
    btn.className = "btn-option";
    btn.innerText = `${key}: ${q.options[key]}`;
    btn.onclick = () => checkAnswer(key);
    optionsDiv.appendChild(btn);
  }
}

function checkAnswer(selected) {
  const q = questions[currentQuestion];
  const explanation = document.createElement("div");
  explanation.className = "explanation";
  if (selected === q.correct) {
    correctCount++;
    explanation.innerText = `тЬЕ рд╕рд╣реА рдЙрддреНрддрд░! (${q.correct})`;
    explanation.style.color = "green";
  } else {
    incorrectCount++;
    explanation.innerText = `тЭМ рдЧрд▓рдд рдЙрддреНрддрд░! рд╕рд╣реА рдЙрддреНрддрд░ рд╣реИ (${q.correct})\n\nЁЯФН ${q.explanation}`;
    explanation.style.color = "red";
  }
  document.getElementById("quizOptions").appendChild(explanation);

  setTimeout(() => {
    currentQuestion++;
    if (currentQuestion < questions.length) {
      showQuestion();
    } else {
      showFinalScore();
    }
  }, 2000);
}

function showFinalScore() {
  document.getElementById("quizQuestion").innerHTML = `<h3>ЁЯОЙ рдЕрднреНрдпрд╛рд╕ рдкреВрд░рд╛ рд╣реБрдЖ!</h3>
    <p>тЬЕ рд╕рд╣реА: ${correctCount}</p>
    <p>тЭМ рдЧрд▓рдд: ${incorrectCount}</p>`;
  document.getElementById("quizOptions").innerHTML = "";
  document.getElementById("submitBtn").style.display = "none";
}

function goToQuestion() {
  const index = parseInt(document.getElementById("gotoInput").value) - 1;
  if (index >= 0 && index < questions.length) {
    currentQuestion = index;
    showQuestion(index);
  } else {
    alert("тЪая╕П рдорд╛рдиреНрдп рдкреНрд░рд╢реНрди рд╕рдВрдЦреНрдпрд╛ рджрд░реНрдЬ рдХрд░реЗрдВ (1 рд╕реЗ " + questions.length + " рддрдХ)");
  }
}

function submitQuiz() {
  showFinalScore();
}
</script>
</body>
</html>
